var user,id,app=angular.module("starter.controllers",["ngSanitize","ionicLazyLoad","ngCordova"]).directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t,o){t.bind("change",function(t){var o=new FileReader;o.onload=function(t){e.$apply(function(){e.fileread=t.target.result})},o.readAsDataURL(t.target.files[0])})}}}]).factory("Footer",function(){var e=new Date,t=e.getFullYear(),o="gemarsehati.com";return{getFooter:function(){var e=t+". "+o;return e}}}).factory("$localstorage",["$window",function(e){return{set:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},setObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")},isLoggedIn:function(){return void 0!==window.localStorage.getItem("id")&&void 0!==window.localStorage.getItem("username")&&void 0!==window.localStorage.getItem("photo")?!0:!1}}}]).factory("$reload",["$window",function(e){return{refresh:function(){return window.location.reload(!0)}}}]).factory("Markers",function(e){var t=[];return{getMarkers:function(){return e.get("http://www.gemarsehati.com/api/getmitra").then(function(e){return t=e})}}}).factory("Events",function(e){return{getEvents:function(){return e.get("http://www.gemarsehati.com/api/getevent").then(function(e){return events=e,events.data})},getDateEvents:function(t){return e.get("http://www.gemarsehati.com/api/getevent").then(function(e){return events=e,result=events.data[t].date,result})}}}).factory("GoogleMaps",function(e,t){function o(){var t={timeout:1e4,enableHighAccuracy:!0};temp=e.getCurrentPosition(t).then(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);i(t);var o={center:t,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};d=new google.maps.Map(document.getElementById("map"),o),temp=google.maps.event.addListenerOnce(d,"idle",function(){a(),n(t)})},function(e){console.log("Could not get location"),a()})}function n(){currentLatLng=l();var e="img/marker_now-small.png",t=new google.maps.Marker({map:d,animation:google.maps.Animation.DROP,position:currentLatLng,icon:e}),o="<h4>Posisi anda sekarang</h4>";c(t,o,0)}function a(){return currentLatLng=l(),temp=t.getMarkers().then(function(e){for(var t=Object.keys(e.data).length,o=(Number.MAX_VALUE,{}),n="img/marker-small.png",a=0,r=0;t>r;r++){var i=e.data,l=e.data,s=i[r].koordinat.split(","),u=s[0],g=s[1],p=new google.maps.LatLng(u,g);if(void 0!=currentLatLng)var m=google.maps.geometry.spherical.computeDistanceBetween(currentLatLng,p);if(2e4>=m){var i=new google.maps.Marker({map:d,animation:google.maps.Animation.DROP,position:p,icon:n});o[a]=l[r],a++,""==l[r].nohp&&(l[r].nohp="-"),""==l[r].email&&(l[r].email="-"),""==l[r].alamat&&(l[r].alamat="-");var h="Nama : "+l[r].nama+"<br/>No hp : "+l[r].nohp+"<br/>Email : "+l[r].email+"<br/>Alamat : "+l[r].alamat;c(i,h,l[r])}}var f=new google.maps.Circle({map:d,radius:2e4,fillColor:"#AA0000"});return f.bindTo("center",i,"position"),o}),temp}function r(){return u=this.dataDetailMitra}function i(e){return this.currentCoordinate=e,e}function l(){return s=this.currentCoordinate}function c(e,t,o){var n=new google.maps.InfoWindow({content:'<div style="width:200px; height:auto">'+t+"</div>"});google.maps.event.addListener(e,"click",function(){n.open(d,e)})}var s,u,d=null;return{init:function(){o();a()},getDetailMitra:function(){return temp=a(),temp},getMitra:function(){return temp=r(),console.log(temp),temp}}}).filter("inSlicesOf",["$rootScope",function(e){return makeSlices=function(t,o){if(o||(o=3),!angular.isArray(t)&&!angular.isString(t))return t;for(var n=[],a=0;a<t.length;a++){var r=parseInt(a/o,10),i=a%o===0;i&&(n[r]=[]),n[r].push(t[a])}return angular.equals(e.arrayinSliceOf,n)?e.arrayinSliceOf:(e.arrayinSliceOf=n,n)},makeSlices}]).controller("AppCtrl",function(e,t,o,n,a,r){r.fromTemplateUrl("templates/popover.html",{scope:e}).then(function(t){e.popover=t}),e.MitraCityButton=function(){a.go("app.mitracity",{},{reload:!0})},photo=n.get("photo"),username=n.get("username"),void 0!==username?(e.login=!1,e.logout=!0):(e.login=!0,e.logout=!1),e.loginData={name:username,photo:photo}}).controller("LoginCtrl",function(e,t,o,n,a,r,i,l,c){function s(e){var t="http://gemarsehati.com/api/getmitraid/"+e;a({method:"get",url:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){i.set("id",e.id),i.set("username",e.nama),i.set("photo",e.foto),i.set("cek","true"),window.location.reload(),n.go("app.home",{},{reload:!0})})}t.nextViewOptions({disableBack:!0}),o.footerText=c.getFooter(),o.loadData=function(){alert("Username "+i.get("username")+"\nphoto "+i.get("photo")+"\nid "+i.get("id"))},o.Login=function(e){r.show({template:"Loading"}),(null==e.email||null==e.password)&&(r.hide(),alert("Email atau Password Anda kosong, mohon dicek kembali"),n.go("app.login",{},{reload:!0}));var o=e.email,i=e.password;a({method:"POST",url:"http://gemarsehati.com/api/login",data:{email:o,password:i},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){alert("login success"),r.hide(),"loginSuccess"==e.message&&(t.nextViewOptions({disableBack:!0}),s(e.id),n.go("app.home",{},{reload:!0}))}).error(function(e){r.hide(),null==e&&alert("Email atau password tidak boleh kosong / cek koneksi anda")})},o.Logout=function(){t.nextViewOptions({disableBack:!0}),n.go("app.home",{},{reload:!0}),window.localStorage.removeItem("id"),window.localStorage.removeItem("username"),window.localStorage.removeItem("photo"),alert("Anda berhasil Logout"),window.location.reload()}}).controller("PDFCtrl",function(e,t,o,n,a,r,i,l,c){if(e.download=function(t){var o=e.pdfs[t].link_pdf,n=o.split("/").pop(),a=cordova.file.externalRootDirectory+n;alert("Sedang mendownload file"),i.download(o,a,{},!0).then(function(e){alert("Download file "+n+" telah berhasil.")},function(e){alert("Download file "+n+" gagal.")},function(e){})},n.show({template:"Loading"}),e.footerText=r.getFooter(),a.get("username"))var s="http://www.gemarsehati.com/api/getpdfuser";else var s="http://www.gemarsehati.com/api/getpdfumum";t({method:"get",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){e.pdfs=t,n.hide()}).error(function(e){n.hide(),c.alert({title:"Connection Error",template:"Check your connection"})})}).controller("HomeCtrl",function(e,t,o,n,a,r,t,i,l,c,s,u,d){r.hide(),n.footerText=u.getFooter(),t.get("username")?(username=t.get("username"),n.isLogin=!0):(username="non user",n.isLogin=!1),o.clearHistory()}).controller("PhotoCtrl",function(e,t,o,n,a,r,l,c,s,u,d){e.show({template:"Loading"}),o.footerText=d.getFooter(),n({method:"get",url:"http://www.gemarsehati.com/api/getphotoalbum",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.photoalbums=e}).error(function(o){e.hide(),t.alert({title:"Connection Error",template:"Check your connection"})}),n({method:"get",url:"http://www.gemarsehati.com/api/getphoto",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){o.length=Object.keys(t).length,o.halfLength=length/2,o.photos=t,e.hide()}).error(function(o){e.hide(),t.alert({title:"Connection Error",template:"Check your connection"})}),o.showImages=function(e){o.activeSlide=e,o.showModal("templates/detailphoto.html")},o.showModal=function(e){l.fromTemplateUrl(e,{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.closeModal=function(){o.modal.hide(),o.modal.remove()},o.updateSlideStatus=function(e){var t=u.$getByHandle("scrollHandle"+e).getScrollPosition().zoom;t==o.zoomMin?s.enableSlide(!0):s.enableSlide(!1)},o.getPhotoAlbum=function(){o.selectedPhotos=[];var t=o.selectedAlbum.id,n=o.length;for(i=0;i<n;i++)o.photos[i].id_album==t&&o.selectedPhotos.push(o.photos[i]);e.hide()}}).controller("VideoCtrl",function(e,t,o,n,a,r,i){r.show({template:"Loading"}),e.footerText=i.getFooter(),e.trustSrc=function(e){return a.trustAsResourceUrl(e)},o({method:"get",url:"http://www.gemarsehati.com/api/getvideo",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){e.videos=t,r.hide()}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("RegisterCtrl",function(e,t,o,n,a){e.footerText=a.getFooter(),o({method:"get",url:"http://www.gemarsehati.com/api/getgender"}).success(function(t){e.genders=t}),o({method:"get",url:"http://www.gemarsehati.com/api/getcity"}).success(function(t){e.cities=t}),e.showSelectValue=function(e){return e.name},e.SendRegister=function(e){if(e.selectedGender){var t=e.selectedGender.id;if(e.selectedCity)var a=e.selectedCity.id}e.address||(e.address=""),e.nophone||(e.nophone=""),e.postal||(e.postal=""),e.lat||(e.lat=""),e.log||(e.log=""),e.fb||(e.fb=""),e.twitter||(e.twitter=""),e.pinbb||(e.pinbb=""),alert(e.foto),o({method:"POST",url:"http://gemarsehati.com/api/register",data:{name:e.fullname,panggilan:e.nickname,notelp:e.nophone,nohp:e.nohp,ms_gender_id:t,address:e.address,ms_city_id:a,kodepos:e.postal,latitude:e.lat,longitude:e.log,email:e.email,password:e.password,facebook:e.fb,twitter:e.twitter,file:e.foto,pin_bb:e.pinbb},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){alert("Data Berhasil Dimasukkan"),console.log(e),n.go("app.home")}).error(function(e){null==e?alert("data yang anda isikan kosong"):alert("input gagal periksa sambungan Internet Anda.")})}}).controller("CityCtrl",function(e,t,o,n){e({method:"get",url:"http://www.gemarsehati.com/api/getcity"}).success(function(e){o.cities=e,o.selectedCity=o.cities[0]})}).controller("GenderCtrl",function(e,t){e({method:"get",url:"http://www.gemarsehati.com/api/getgender"}).success(function(e){t.genders=e}),t.showSelectValue=function(e){return e.name}}).controller("TestimoniCtrl",function(e,t,o,n,a){n.show({template:"Loading"}),o.footerText=a.getFooter(),o.bisnisTestimoni=function(){n.show({template:"Loading"}),e({method:"get",url:"http://www.gemarsehati.com/api/gettestimonibisnis",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.hide(),o.testimonis=e}).error(function(e){n.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})},o.kesehatanTestimoni=function(){n.show({template:"Loading"}),e({method:"get",url:"http://www.gemarsehati.com/api/gettestimonikesehatan",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.hide(),o.testimonis=e})}}).controller("ArticlesCtrl",function(e,t,o,n,a,r,i){r.show({template:"Loading"}),o.footerText=i.getFooter(),e({method:"get",url:"http://www.gemarsehati.com/api/getarticles",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.articles=e,o.whicharticle=a.params.aId,r.hide()}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("TechnologyCtrl",function(e,t,o,n,a,r,i){r.show({template:"Loading"}),o.footerText=i.getFooter(),e({method:"get",url:"http://www.gemarsehati.com/api/gettechnology",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.technologies=e,o.whichtechnology=a.params.aId,r.hide()}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("EventCtrl",function(e,t,o,n,a,r,l){r.show({template:"Loading"}),n.footerText=l.getFooter(),n.events=[],n.archivedEvents=[],n.latestEvents=[],n.showArchived=function(){r.show({template:"Loading"}),n.archivedEvents=[],o({method:"get",url:"http://www.gemarsehati.com/api/getevent",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.hide();var t=new Date,o=t.getMonth()+1,a=(t.getDate(),t.getFullYear());for(i=0;i<e.length;i++){var l=e[i].date.split("-"),c=l[0],s=l[1].replace(/(^)0+/g,"$1");l[2].replace(/(^)0+/g,"$1");c>a||s>o||o>=s&&n.archivedEvents.push(e[i])}n.events=n.archivedEvents}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})},n.latestEvent=function(){r.show({template:"Loading"}),n.latestEvents=[],o({method:"get",url:"http://www.gemarsehati.com/api/getevent",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.hide();var t=new Date,o=t.getMonth()+1,a=t.getDate(),l=t.getFullYear();for(i=0;i<e.length;i++){var c=e[i].date.split("-"),s=c[0],u=c[1].replace(/(^)0+/g,"$1"),d=c[2].replace(/(^)0+/g,"$1");s>l?n.latestEvents.push(e[i]):u>o?n.latestEvents.push(e[i]):d>a&&u>=o&&n.latestEvents.push(e[i])}n.events=n.latestEvents}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}}).controller("MitraFinderCtrl",function(e,t,o,n,a,r,i,l){r.show(),e.footerText=i.getFooter(),e.reloadPage=function(){window.location.reload()},a.init(),temp=a.getDetailMitra(),temp.then(function(t){e.mitras=t,l(function(){r.hide()},5e3),t||window.location.reload(!0)}),e.toggleGroup=function(t){e.isGroupShown(t)?e.shownGroup=null:e.shownGroup=t},e.isGroupShown=function(t){return e.shownGroup===t}}).controller("ContactCtrl",function(e,t,o,n,a){n.hide(),e.footerText=a.getFooter(),e.SendContact=function(e){t({method:"POST",url:"http://gemarsehati.com/api/contactus",data:{name:e.nama,email:e.email,nohp:e.nohp,title:e.title,message:e.message},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){"contactusSuccess"==e.message&&o.go("app.home")}).error(function(e){null==e?alert("Cek kembali inputan anda"):alert("Periksa sambungan Internet Anda.")})}}).controller("ForgotCtrl",function(e,t,o,n,a){e.footerText=a.getFooter(),e.SendResetPass=function(e){o({method:"POST",url:"http://gemarsehati.com/api/resetpass",data:{email:e.email},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,t,o,a){alert(e.data),"resetPassSuccess"==e.message&&n.go("app.login")}).error(function(e){null==e?alert("Masukkan alamat email anda"):alert("Periksa sambungan Internet Anda.")})}}).controller("InputCtrl",function(e,t,o){e.footerText=o.getFooter(),e.fileName="nothing",e.openFileDialog=function(){console.log("fire! $scope.openFileDialog()"),ionic.trigger("click",{target:document.getElementById("file")})},angular.element("#file").on("change",function(t){console.log("fire! angular#element change event");var o=t.target.files[0];e.fileName=o.name,e.$apply()})}).controller("AboutCtrl",function(e,t,o,n,a,r,i){r.show({template:"Loading"}),e.footerText=i.getFooter(),o({method:"get",url:"http://www.gemarsehati.com/api/aboutus"}).success(function(t){r.hide(),e.aboutus=t,e.whichabout=a.params.aId}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("SocialMediaCtrl",function(e,t,o,n){e.show({template:"Loading"}),e.hide(),n.footerText=o.getFooter()}).controller("MitraCityCtrl",function(e,t,o,n,a,r){e.show({template:"Loading"}),n.footerText=r.getFooter(),o({method:"get",url:"http://www.gemarsehati.com/api/getcity"}).success(function(t){e.hide(),n.cities=t,$id=a.params.aId,o({method:"get",url:"http://www.gemarsehati.com/api/getcity/"+$id}).success(function(e){n.city=e})})}).controller("ProfilCtrl",function(e,t,o,n,a,r,i,t){e.show({template:"Loading"}),r.footerText=i.getFooter();var l=a.get("id");l?r.isLogin=!0:(r.isLogin=!1,n.go("app.home",{},{reload:!0})),o({method:"GET",url:"http://gemarsehati.com/api/getmitraid/"+l,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){e.hide(),r.profil=t}).error(function(o){e.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("ProductCtrl",function(e,t,o,n,a,r,i){r.show({template:"Loading"}),e.footerText=i.getFooter(),o({method:"get",url:"http://www.gemarsehati.com/api/getleveluk"}).success(function(t){r.hide(),e.products=t,e.whichproduct=a.params.aId}).error(function(e){r.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("CreditCtrl",function(e,t,o,n,a,r){a.show({template:"Loading"}),e.footerText=r.getFooter(),o({method:"get",url:"http://www.gemarsehati.com/api/getcredit"}).success(function(t){a.hide(),e.credits=t}).error(function(e){a.hide(),t.alert({title:"Connection Error",template:"Check your connection"})})}).controller("SplashCtrl",function(e,t,o,n,a,r,i){n(function(){o.show()},3e3),console.log("awal "+i.flag),0==i.flag?(console.log("1 - ke notif"),console.log(i.flag),n(function(){o.hide(),a.go("app.notif")},3e3),o.hide(),r.nextViewOptions({disableBack:!0})):1==i.flag&&(console.log("2 - ke home"),console.log(i.flag),n(function(){o.hide(),a.go("app.home")},5e3),o.hide(),i.flag=!1,r.nextViewOptions({disableBack:!0})),document.addEventListener("batchPushReceived",function(e){i.flag=!1;var t=e.payload;i.message=t.msg,console.log("1 - ke notif"),console.log(i.flag),n(function(){o.hide(),a.go("app.notif")},3e3),o.hide()})}).controller("NotifCtrl",function(e,t,o,n){o.show({template:"Loading"}),t.message=n.message,t.footerText=e.getFooter(),o.hide()});